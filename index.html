<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WeatherPane</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/css.css">
    <script>
        // Apply theme immediately to prevent flash of unstyled content
        (function () {
            const mode = localStorage.getItem('weatherPane:themeMode') || 'auto';
            const color = localStorage.getItem('weatherPane:themeColor') || 'blue';
            let effectiveMode = mode;
            if (mode === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                effectiveMode = prefersDark ? 'dark' : 'light';
            }
            // Set on documentElement so it's available before body is parsed
            document.documentElement.setAttribute('data-theme-mode', effectiveMode);
            document.documentElement.setAttribute('data-theme-color', color);
            // Also set on body when it's available
            document.addEventListener('DOMContentLoaded', function () {
                document.body.setAttribute('data-theme-mode', effectiveMode);
                document.body.setAttribute('data-theme-color', color);
            });
        })();
    </script>
</head>

<body>
    <div id="cloudLayer" aria-hidden="true"></div>
    <header>
        <span class="dot"></span>
        <h1>WeatherPane</h1>
        <div class="loc" id="loc">Locating…</div>
        <button class="edit-btn" id="editBtn" aria-label="Edit cards"><i class="fa-solid fa-pen"></i></button>
        <div class="header-separator"></div>
        <button class="settings-btn" id="settingsBtn" aria-label="Settings"><i class="fa-solid fa-gear"></i></button>
    </header>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <div class="settings-header">
                <div>
                    <p class="settings-kicker">Tweak your pane</p>
                    <h2>Settings</h2>
                </div>
                <button class="close-btn" id="closeSettingsBtn" aria-label="Close settings">×</button>
            </div>
            <div class="settings-body">
                <div class="settings-shell">
                    <nav class="settings-nav" id="settingsNav" role="tablist" aria-label="Settings sections">
                        <div class="settings-nav-scroll" id="settingsNavScroll">
                            <div class="settings-nav-indicator" id="settingsNavIndicator"></div>
                        </div>
                    </nav>
                    <div class="settings-panels" id="settingsPanels">
                        <section class="settings-panel active" id="appearanceTab" data-tab-id="appearance"
                            data-label="Appearance" data-icon="fa-palette">
                            <div class="settings-panel-header">
                                <p class="settings-panel-kicker">Look & feel</p>
                                <h3>Appearance</h3>
                                <p class="settings-panel-description">Switch themes and pick the accent used across the
                                    app.</p>
                            </div>
                            <div class="setting-item surface">
                                <div>
                                    <span class="setting-label">Theme Mode</span>
                                    <span class="setting-description">Choose light, dark, or automatic based on system
                                        preferences</span>
                                </div>
                                <div class="segmented-control">
                                    <input type="radio" name="themeMode" id="themeModeAuto" value="auto" checked>
                                    <label for="themeModeAuto">Auto</label>
                                    <input type="radio" name="themeMode" id="themeModeLight" value="light">
                                    <label for="themeModeLight">Light</label>
                                    <input type="radio" name="themeMode" id="themeModeDark" value="dark">
                                    <label for="themeModeDark">Dark</label>
                                </div>
                            </div>
                            <div class="setting-item surface">
                                <div>
                                    <span class="setting-label">Accent Color</span>
                                    <span class="setting-description">Customize the color scheme of the interface</span>
                                </div>
                                <div class="color-picker">
                                    <input type="radio" name="themeColor" id="colorBlue" value="blue" checked>
                                    <label for="colorBlue" class="color-option" data-color="blue">
                                        <span class="color-swatch"
                                            style="background: linear-gradient(135deg, #4ea3ff 0%, #0b1320 100%)"></span>
                                        <span class="color-name">Blue</span>
                                    </label>
                                    <input type="radio" name="themeColor" id="colorPurple" value="purple">
                                    <label for="colorPurple" class="color-option" data-color="purple">
                                        <span class="color-swatch"
                                            style="background: linear-gradient(135deg, #a855f7 0%, #1a0d24 100%)"></span>
                                        <span class="color-name">Purple</span>
                                    </label>
                                    <input type="radio" name="themeColor" id="colorPink" value="pink">
                                    <label for="colorPink" class="color-option" data-color="pink">
                                        <span class="color-swatch"
                                            style="background: linear-gradient(135deg, #ec4899 0%, #240d1a 100%)"></span>
                                        <span class="color-name">Pink</span>
                                    </label>
                                    <input type="radio" name="themeColor" id="colorGreen" value="green">
                                    <label for="colorGreen" class="color-option" data-color="green">
                                        <span class="color-swatch"
                                            style="background: linear-gradient(135deg, #10b981 0%, #0a1f14 100%)"></span>
                                        <span class="color-name">Green</span>
                                    </label>
                                    <input type="radio" name="themeColor" id="colorOrange" value="orange">
                                    <label for="colorOrange" class="color-option" data-color="orange">
                                        <span class="color-swatch"
                                            style="background: linear-gradient(135deg, #f97316 0%, #241a0d 100%)"></span>
                                        <span class="color-name">Orange</span>
                                    </label>
                                    <input type="radio" name="themeColor" id="colorTeal" value="teal">
                                    <label for="colorTeal" class="color-option" data-color="teal">
                                        <span class="color-swatch"
                                            style="background: linear-gradient(135deg, #14b8a6 0%, #0d1f24 100%)"></span>
                                        <span class="color-name">Teal</span>
                                    </label>
                                    <input type="radio" name="themeColor" id="colorGrey" value="grey">
                                    <label for="colorGrey" class="color-option" data-color="grey">
                                        <span class="color-swatch"
                                            style="background: linear-gradient(135deg, #6b7280 0%, #0f1014 100%)"></span>
                                        <span class="color-name">Grey</span>
                                    </label>
                                </div>
                            </div>
                        </section>
                        <section class="settings-panel" id="backgroundTab" data-tab-id="background"
                            data-label="Live Background" data-icon="fa-mountain-sun">
                            <div class="settings-panel-header">
                                <p class="settings-panel-kicker">Atmosphere</p>
                                <h3>Live Background</h3>
                                <p class="settings-panel-description">Preview the animated canvas scenes and control how
                                    they play.</p>
                            </div>
                            <div class="setting-item surface">
                                <div class="background-preview-container">
                                    <div class="background-preview" id="backgroundPreview">
                                        <button class="preview-nav-btn prev" id="prevSceneBtn"
                                            aria-label="Previous scene">
                                            <i class="fa-solid fa-chevron-left"></i>
                                        </button>
                                        <button class="preview-nav-btn next" id="nextSceneBtn"
                                            aria-label="Next scene">
                                            <i class="fa-solid fa-chevron-right"></i>
                                        </button>
                                        <div class="preview-dots" id="previewDots"></div>
                                    </div>
                                    <div class="scene-info">
                                        <span class="scene-info-icon" id="sceneInfoIcon">
                                            <i class="fa-solid fa-wand-sparkles"></i>
                                        </span>
                                        <span class="scene-info-name" id="sceneInfoName">Automatic</span>
                                    </div>
                                </div>
                            </div>
                            <div class="setting-item surface">
                                <div>
                                    <span class="setting-label">Animation State</span>
                                    <span class="setting-description">Control the background animation playback</span>
                                </div>
                                <div class="segmented-control">
                                    <input type="radio" name="cloudState" id="cloudOn" value="on" checked>
                                    <label for="cloudOn">On</label>
                                    <input type="radio" name="cloudState" id="cloudPaused" value="paused">
                                    <label for="cloudPaused">Paused</label>
                                    <input type="radio" name="cloudState" id="cloudOff" value="off">
                                    <label for="cloudOff">Off</label>
                                </div>
                            </div>
                        </section>
                        <section class="settings-panel" id="cardsTab" data-tab-id="cards" data-label="Cards"
                            data-icon="fa-layer-group">
                            <div class="settings-panel-header">
                                <p class="settings-panel-kicker">Dashboard</p>
                                <h3>Cards</h3>
                                <p class="settings-panel-description">Toggle visibility of cards in the grid.</p>
                            </div>
                            <div class="setting-item surface">
                                <div id="cardList" class="card-list"></div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main>
        <div class="content-rail">
            <!-- Left pane: Sun position visualization -->
            <section class="sun-viz" id="sunViz">
                <div class="sun-viz-background" id="sunVizBackground"></div>
                <div class="sun-viz-content">
                    <div class="sun-viz-shell" id="sunVizShell">
                        <div class="current-time-display" id="currentTimeDisplay">12:00 AM</div>
                        <div class="solar-event-countdown" id="solarEventCountdown">
                            <span class="event-name">Solar Noon</span>
                            <span class="event-time">in 1 hour, 31 minutes</span>
                        </div>
                        <canvas id="sunCanvas"></canvas>
                        <div class="time-slider-container">
                            <div id="timeSlider" class="tick-slider"
                                role="slider"
                                tabindex="0"
                                aria-label="Time of day slider, use arrow keys to adjust"
                                aria-valuemin="0"
                                aria-valuemax="1439"
                                aria-valuenow="0"
                                aria-valuetext="12:00 AM">
                                <!-- Ticks will be generated dynamically by JavaScript -->
                            </div>
                            <div class="time-pill" id="timePill">
                                <span class="time-text">12:00 AM</span>
                                <button class="time-reset-btn" id="timeResetBtn" aria-label="Reset to current time">×</button>
                            </div>
                            <div class="solar-event-markers" id="solarEventMarkers">
                                <div class="marker sunrise" id="markerSunrise"></div>
                                <div class="marker noon" id="markerNoon"></div>
                                <div class="marker sunset" id="markerSunset"></div>
                            </div>
                        </div>
                    </div>
                    <div class="sun-detail-overlay" id="sunDetailOverlay" aria-live="polite">
                        <div class="sun-detail-header">
                            <div>
                                <p class="eyebrow">Card details</p>
                                <h3 id="sunDetailTitle">Expanded view</h3>
                                <p class="sun-detail-sub" id="sunDetailSub">Select a card to see deeper context.</p>
                            </div>
                            <button class="sun-detail-close" id="closeDetailOverlay" aria-label="Close details and return to sun graph">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="sun-detail-body" id="sunDetailBody"></div>
                    </div>
                </div>
            </section>

            <!-- Right pane: Info cards -->
            <div id="panel">
                <div class="panel-intro">
                    <p class="eyebrow">Daily briefing</p>
                    <div class="panel-intro-row">
                        <div>
                            <h2>Today at a glance</h2>
                            <p class="panel-intro-sub">Live conditions, solar milestones, and upcoming sky events tuned to your coordinates.</p>
                        </div>
                        <div class="pill-group" aria-hidden="true">
                            <span class="pill accent">Live data</span>
                            <span class="pill outline">Drag to reorder cards</span>
                        </div>
                    </div>
                </div>
                <section class="grid" id="todayGrid">

                </section>
            </div>
        </div>
    </main>

    <div class="footer">Data: <a href="https://open-meteo.com/" target="_blank" rel="noopener">Open‑Meteo</a> & <a
            href="https://github.com/mourner/suncalc" target="_blank" rel="noopener">SunCalc</a>. No API key
        required. Geolocation stays in‑browser.</div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- Sun/Moon calculations -->
    <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>
    <!-- Three.js for volumetric cloud rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"
        integrity="sha512-334uBDwY0iZ2TklV1OtDtBW9vp7jjP7SWRzT7Ehu1fdtPIjTpCwTSFb8HI/YBau9L1/kRBEOALrS229Kry4yFQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Muuri for card layout and drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/web-animations-js@2.3.2/web-animations.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/muuri@0.9.5/dist/muuri.min.js"></script>
    <!-- WeatherPane modules (order matters for dependencies) -->
    <script src="js/utils.js"></script>
    <script src="js/solar-calculations.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/astronomical-events.js"></script>
    <script src="js/canvas-scenes.js"></script>
    <script src="js/threejs-volumetric-clouds.js"></script>
    <script src="js/storm-scene.js"></script>
    <script src="js/scene-manager.js"></script>
    <script src="js/solar-visualization.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/card-renderer.js"></script>
    <script src="js/grid.js"></script>
    <script src="js/main.js"></script>
</body>

</html>
